# Backend Fire Test Plan (Hosted Railway: Agent_Max)

Updated: 2025-11-05
Owner: Cascade (assistant)

## Target
- Domain: https://agentmax-production.up.railway.app
- Auth header: `X-API-Key` (read from `.env.production` â†’ `VITE_API_KEY`)
- User header: `X-User-Id` optional (we use `fire-tester`)

## Scope
- Verify public health & memory readiness
- Exercise chat streaming and autonomous streaming endpoints used by desktop UI
- Run API smoke (profile, conversation, facts, semantic, agents)
- Capture results as JSONL and triage failures by class (401/403, 404/405, 5xx)

## Scripts Added
- scripts/integration/chat_stream_fire_test.mjs
  - Sends a matrix of prompts across two modes: helpful (chat) and autonomous
  - Uses UI endpoints with SSE; logs all events and timing to `tests/e2e/_reports/chat_fire_test_<timestamp>.jsonl`
  - Falls back to JSON chat on stream failure

## How to Run
1) Chat fire test (reads .env.production for URL + key)
```
node scripts/integration/chat_stream_fire_test.mjs
```
2) API contract smoke (Playwright)
```
API_URL="https://agentmax-production.up.railway.app" TEST_API_KEY="<key or taken from .env.production>" npm run test:api -s
```
3) Optional legacy JSON chat smoke
```
bash scripts/integration/chat_smoke_test.sh "Hello from smoke test"
```

## Expected Outcomes
- Health: 200 OK on `/health` and `/api/memory/health`
- Chat (helpful): SSE events with tokens; summary in JSONL (includes ttff, total, event count)
- Autonomous: plan/thinking/step/done events (execution may be limited per server policy)
- API smoke: v2 routes respond (200/401/403 acceptable depending on auth); 404/405 indicates path drift

## Artifacts
- tests/e2e/_reports/chat_fire_test_<timestamp>.jsonl (SSE logs + results)
- play-results.json (Playwright json report)
- tests/e2e/_reports/latest-triage.md (generated by `npm run test:api:triage`)

## Follow-up
- If failures:
  - Collect recent Railway deploy logs
  - Classify by 401/403 vs 404/405 vs 5xx
  - Propose fixes (headers, route versions, env vars, model providers)
- Publish results + recommendations to ProjectOutline/Backend_Fire_Test_Results.md
